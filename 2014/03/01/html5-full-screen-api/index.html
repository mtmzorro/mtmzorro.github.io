<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>MZengine › [译]HTM5 Full-Screen API 怎么玩 - -</title>
  <meta name="author" content="mTmzorro">
  
  <meta name="description" content="如果你不喜欢改变，那么你可能并不适合干web开发这行。我曾经在2012年底发表过Full-Screen API，当时我表示一些实现细节应该修改下，不过我从来没想过一年之后我得重新写一版！这也许不是最后一版，不过我需要感谢David Storey给我指出了最近技术方法的发展方向…

Full-Scre">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="[译]HTM5 Full-Screen API 怎么玩 - -"/>
  <meta property="og:site_name" content="MZengine"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="MZengine" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-32857089-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</head>


<body>
  <header id="header"><div class="meta inner">
  <h1><a href="/">MZengine</a></h1>
  <h2><a href="/"></a></h2>
  <nav id="main-nav">
    <ul>
      
      <li><a href="/archives">文章归档</a></li>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
</div>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  <div class="post-content">
    <header>
      
  
    <h1 class="title">[译]HTM5 Full-Screen API 怎么玩 - -</h1>
  

      
      <time datetime="2014-03-01T14:08:27.000Z">Mar 1 2014</time>
      
    </header>
    <div class="entry">
      
        <blockquote>
<p>如果你不喜欢改变，那么你可能并不适合干web开发这行。我曾经在2012年底发表过<a href="http://www.sitepoint.com/html5-full-screen-api/" target="_blank">Full-Screen API</a>，当时我表示一些实现细节应该修改下，不过我从来没想过一年之后我得重新写一版！这也许不是最后一版，不过我需要感谢<a href="http://twitter.com/dstorey" target="_blank">David Storey</a>给我指出了最近技术方法的发展方向…</p>
</blockquote>
<h2 id="Full-Screen_API_是个啥">Full-Screen API 是个啥</h2>
<p>这个API允许一个元素用全屏方式来展示。不过并不是你去按<code>F11</code>来强制你的浏览器进入全屏模式，这个API可以用于运行在容器中的图片、视频和游戏。当你进入全屏模式时，用户会接到一条信息来告诉他们能按<code>ESC</code>在任何时间返回原来页面。</p>
<p>Full-Screen API 现在已经支持了包括IE11在内的大部分桌面浏览器（译者：天联系到天朝苦比的IE6等占有率）。对移动端也有部分支持，不过他们基本都已经泡在全屏模式下了。别高兴的太早，很不幸我们还有一些差别微调、浏览器前缀以及不同浏览器的兼容性需要解决…</p>
<h2 id="The_JavaScript_API">The JavaScript API</h2>
<p>假设我们有张图片ID是<code>myimage</code>想要在全屏模式下展示。所需要用到的主要方法和属性如下：</p>
<h3 id="document-fullscreenEnabled">document.fullscreenEnabled</h3>
<p>当<code>document</code>允许全屏模式时候，这个属性会返回<code>true</code>。这玩意也能拿来检查浏览器是否支持全屏API：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="keyword">if</span> (document.fullscreenEnabled) { ... }
</pre></td></tr></table></figure>

<p>早些时候这个接口实现的属性上是大写字母‘S’在‘Screen’，而且Firefox中仍然需要大写。下面是加上跨浏览器支持的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="comment">// full-screen available?</span>
<span class="keyword">if</span> (
    document.fullscreenEnabled ||
    document.webkitFullscreenEnabled ||
    document.mozFullScreenEnabled ||
    document.msFullscreenEnabled
) {
...
}
</pre></td></tr></table></figure>

<p>Opera 12 是唯一一个不需要prefix的浏览器，不过Opera 15+ 得使用<code>webkit</code>。</p>
<h3 id="element-requestFullscreen()">element.requestFullscreen()</h3>
<p>这个方法可以让单个元素进入全屏模式，举个栗子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>document.getElementById(<span class="string">"myimage"</span>).requestFullscreen();
</pre></td></tr></table></figure>

<p>‘screen’ 首字母是小写。跨浏览器版本：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre><span class="keyword">var</span> i = document.getElementById(<span class="string">"myimage"</span>);
 
<span class="comment">// go full-screen</span>
<span class="keyword">if</span> (i.requestFullscreen) {
    i.requestFullscreen();
} <span class="keyword">else</span> <span class="keyword">if</span> (i.webkitRequestFullscreen) {
    i.webkitRequestFullscreen();
} <span class="keyword">else</span> <span class="keyword">if</span> (i.mozRequestFullScreen) {
    i.mozRequestFullScreen();
} <span class="keyword">else</span> <span class="keyword">if</span> (i.msRequestFullscreen) {
    i.msRequestFullscreen();
}
</pre></td></tr></table></figure>

<h3 id="document-fullscreenElement">document.fullscreenElement</h3>
<p>这个属性会返回当前被全屏显示的元素或者<code>null</code>（非全屏时）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>document.getElementById(<span class="string">"myimage"</span>).requestFullscreen();
</pre></td></tr></table></figure>

<p>‘screen’是小写。跨浏览器版本：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="comment">// are we full-screen?</span>
<span class="keyword">if</span> (
    document.fullscreenElement ||
    document.webkitFullscreenElement ||
    document.mozFullScreenElement ||
    document.msFullscreenElement
) {
...
}
</pre></td></tr></table></figure>

<h3 id="document-exitFullscreen()">document.exitFullscreen()</h3>
<p>这个方法可以退出全屏模式：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="keyword">if</span> (document.fullscreenElement) { ... }
</pre></td></tr></table></figure>

<p>‘screen’也是小写，之前这玩意叫<code>cancelFullScreen</code>，Firefox中还这么叫。跨浏览器版本：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre><span class="comment">// exit full-screen</span>
<span class="keyword">if</span> (document.exitFullscreen) {
    document.exitFullscreen();
} <span class="keyword">else</span> <span class="keyword">if</span> (document.webkitExitFullscreen) {
    document.webkitExitFullscreen();
} <span class="keyword">else</span> <span class="keyword">if</span> (document.mozCancelFullScreen) {
    document.mozCancelFullScreen();
} <span class="keyword">else</span> <span class="keyword">if</span> (document.msExitFullscreen) {
    document.msExitFullscreen();
}
</pre></td></tr></table></figure>

<h3 id="document-fullscreenchange_event">document.fullscreenchange <code>event</code></h3>
<p>这个事件会在进入或者退出全屏模式时候触发。这个事件没有返回什么信息，如果你要检查当前是否为全屏模式，其实你可以用<code>document.fullscreenElement</code>不是<code>null</code>来检查是否全屏模式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>document.addEventListener(<span class="string">"fullscreenchange"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> ... });
</pre></td></tr></table></figure>

<p>这名字一直没变过，不过还需要做些跨浏览器处理：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>document.addEventListener(<span class="string">"fullscreenchange"</span>, FShandler);
document.addEventListener(<span class="string">"webkitfullscreenchange"</span>, FShandler);
document.addEventListener(<span class="string">"mozfullscreenchange"</span>, FShandler);
document.addEventListener(<span class="string">"MSFullscreenChange"</span>, FShandler);
</pre></td></tr></table></figure>

<h3 id="document-fullscreenerror_event">document.fullscreenerror <code>event</code></h3>
<p>全屏模式也有失败状态。举个栗子，<code>iframes</code>没有<code>allowfullscreen</code>属性或者有些插件等东西会阻止全屏模式。一个<code>fullscreenerror</code>事件因此会被触发.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>document.addEventListener(<span class="string">"fullscreenerror"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> ... });
</pre></td></tr></table></figure>

<p>这名字一直没变过，不过还需要做些跨浏览器处理：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>
document.addEventListener(<span class="string">"fullscreenerror"</span>, FSerrorhandler);
document.addEventListener(<span class="string">"webkitfullscreenerror"</span>, FSerrorhandler);
document.addEventListener(<span class="string">"mozfullscreenerror"</span>, FSerrorhandler);
document.addEventListener(<span class="string">"MSFullscreenError"</span>, FSerrorhandler);
</pre></td></tr></table></figure>

<h2 id="Full-Screen_CSS">Full-Screen CSS</h2>
<p>我们也能用CSS来影响全屏样式</p>
<h3 id=":fullscreen_伪类">:fullscreen <code>伪类</code></h3>
<p>你可以使用这个伪类来改变一个元素或者他的子元素在全屏模式中的的样式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>:fullscreen {
    ...
}
</pre></td></tr></table></figure>

<p>这玩意以前叫<code>:full-screen</code>，而且在webkit内核浏览器和Firefox中还这么叫。跨浏览器代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre><span class="pseudo">:-webkit-full-screen</span> <span class="rules">{
<span class="rule">}</span></span>
 
<span class="pseudo">:-moz-full-screen</span> <span class="rules">{
<span class="rule">}</span></span>
 
<span class="pseudo">:-ms-fullscreen</span> <span class="rules">{
<span class="rule">}</span></span>
 
<span class="pseudo">:fullscreen</span> <span class="rules">{
<span class="rule">}</span></span>
</pre></td></tr></table></figure>

<p><em>（译者：多使用SASS之类的 CSS预处理语言来解决这些蛋疼的prefix把）</em></p>
<h3 id="::backdrop">::backdrop</h3>
<p>你也可以用这个属性来给一个元素在全屏模式中设置一个不一样的单色或者图片遮罩背景：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="pseudo">:fullscreen</span><span class="pseudo">::backdrop</span> <span class="rules">{
    <span class="rule"><span class="attribute">background-color</span>:<span class="value"> <span class="hexcolor">#006</span></span></span>; <span class="comment">/* dark blue */</span>
<span class="rule">}</span></span>
</pre></td></tr></table></figure>

<p><code>backdrop</code>是一个在全屏元素之下、页面之上的伪元素。IE11支持，Firefox 和 Opera 12不支持。Chrome、Safari、Opera 15+都支持但是并不允许去修改。所以目前你只能在IE11中使用，举个栗子：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="pseudo">:-ms-fullscreen</span><span class="pseudo">::-ms-backdrop</span> <span class="rules">{
    <span class="rule"><span class="attribute">background-color</span>:<span class="value"> <span class="hexcolor">#006</span></span></span>; <span class="comment">/* dark blue */</span>
<span class="rule">}</span></span>
</pre></td></tr></table></figure>

<h2 id="样式差异">样式差异</h2>
<p>在IE11，Firefox，Opera 12中全屏的元素会被设置成 100%的宽高。图片隐藏被拉伸、原始的宽高比也被忽略了。</p>
<ul>
<li>在IE11中设置一个宽高属性会把全屏元素放到一个暗色的背景（可以使用<code>::backdrop</code>设置）中并基于浏览器左上角。</li>
<li>Opera 12和IE11的展现方式很像，不过是个透明的背景。</li>
<li>Firefox忽略尺寸大小。</li>
</ul>
<p>Chrome、Safari、Opera 15+中 元素都被居中放置在一个黑色的背景中。</p>
<p>如果你想保持一致性，那么让Webkit/Blink内核的浏览器变成Firefox/IE11那样很容易：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="pseudo">:-webkit-full-screen</span> <span class="rules">{
    <span class="rule"><span class="attribute">position</span>:<span class="value"> fixed</span></span>;
    <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100</span>%</span></span>;
    <span class="rule"><span class="attribute">top</span>:<span class="value"> <span class="number">0</span></span></span>;
    <span class="rule"><span class="attribute">background</span>:<span class="value"> none</span></span>;
<span class="rule">}</span></span>
</pre></td></tr></table></figure>

<p>另一种思路，你也能让IE11符合Webkit/Blink内核的浏览器居中那样的标准：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="pseudo">:-ms-fullscreen</span> <span class="rules">{
  <span class="rule"><span class="attribute">width</span>:<span class="value"> auto</span></span>;
  <span class="rule"><span class="attribute">height</span>:<span class="value"> auto</span></span>;
  <span class="rule"><span class="attribute">margin</span>:<span class="value"> auto</span></span>;
<span class="rule">}</span></span>
</pre></td></tr></table></figure>

<p>这个方法对Firefox不管用，就像之前提到那样他忽略了宽高设置。怎么解决那，你需要把父级元素设置成全屏模式，然后做出适当的调整就像<a href="http://blogs.sitepointstatic.com/examples/tech/full-screen/index2.html" target="_blank">demo</a>这样.</p>
<h2 id="准备好开搞了？">准备好开搞了？</h2>
<p>HTML5 Full-Screen API相当的简单，不过为了解决浏览器兼容性问题还需要写一大坨很丑的代码，而且谁也不能保证这些浏览器各种API不会再次修改。这种情况以后应该会有所改善，所以在API稳定前把时间和经理投入到其他功能上是个更好的选择。</p>
<p>最后，全屏模式对于HTML5游戏和视频网站来说是必不可少的。如果你不想自己去维护这些代码，考虑使用一些第三方的库把，<a href="https://github.com/sindresorhus/screenfull.js/" target="_blank">screenfull.js</a>就是一个不错的选择。</p>
<p>Best of luck!</p>

      
    </div>
    
    <footer>
      <div class="alignleft">
      
      
      </div>
      <div class="clearfix"></div>
    </footer>
    
  </div>
</article>


<section id="comment">
  
            <!-- Duoshuo Comment BEGIN -->
            <div class="ds-thread"></div>
            <script type="text/javascript">
                var duoshuoQuery = {short_name:"mtmzorro"};
                (function() {
                    var ds = document.createElement('script');
                    ds.type = 'text/javascript';ds.async = true;
                    ds.src = 'http://static.duoshuo.com/embed.js';
                    ds.charset = 'UTF-8';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
                })();
            </script>
            <!-- Duoshuo Comment END -->
      
  
</section>

</div></div>
    <div class="clearfix"></div>
  </div>
  <footer id="footer"><div class="inner"><div class="alignleft">
  <p>
  
    &copy; 2014 mTmzorro
  
  </p>
  <p>
    <a href="http://github.com/willerce/hexo-theme-noderce">Noderce</a> Theme By <a href="http://willerce.com" >willerce</a>
  </p>

</div>
<div class="clearfix"></div></div></footer>
  <script type="text/javascript">

</script>

</body>
</html>
