<!DOCTYPE html>
<html lang="zh-CN">

  <head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta name="author" content="zchengsite, 1451426471@qq.com">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  
  <title>Typescript 重走常用设计模式（二） | MT_Engine</title>

  
    <link rel="apple-touch-icon" href="/images/avatar.jpg">
    <link rel="icon" href="/favicon.ico">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  <!-- <link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/iconfont/iconfont.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css"> -->
  <!-- use jsdelivr CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mtmzorro/mtmzorro.github.io@master/css/base.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mtmzorro/mtmzorro.github.io@master/iconfont/iconfont.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mtmzorro/mtmzorro.github.io@master/css/github-markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mtmzorro/mtmzorro.github.io@master/css/highlight.css">

  <!-- jquery3.3.1 -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>

  <!-- fancybox -->
  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <script async src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  <!-- <script src="/js/fancybox.js"></script> -->
  <script src="https://cdn.jsdelivr.net/gh/mtmzorro/mtmzorro.github.io@master/js/fancybox.js"></script>

  
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-50852091-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-50852091-1');
    </script>
  

</head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/"><img src="/images/avatar.jpg" alt=""></a>
    <div class="nickname"><a href="/about/">mTmzorro</a></div>
    <div class="self-tag"><a href="/about/">前端手艺人/科技产品爱好者/军迷/Gamer/折腾家</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">主页</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">归档</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">标签</a>
        </li>
      
        <li class="nav-item" data-path="/guestbook/">
          <a href="/guestbook/">留言</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">关于</a>
        </li>
      
    </ul>
  </div>
</div>

<!-- <script src="/js/activeNav.js"></script> -->
<script src="https://cdn.jsdelivr.net/gh/mtmzorro/mtmzorro.github.io@master/js/activeNav.js"></script>


      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->


  
  
  
  
  
  

  
  
  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">Typescript 重走常用设计模式（二）</div>
      <div class="post-attach">
        <span class="post-pubtime">2019-03-22</span>
        
          <span class="post-tags">
            <i class="iconfont icon-tags" title="标签 | tags"></i>
            
            <span class="span--tag">
              <a href="/tags/typescript/" title="查看 typescript 标签">
                #typescript
              </a>
            </span>
            
            <span class="span--tag">
              <a href="/tags/javascript/" title="查看 javascript 标签">
                #javascript
              </a>
            </span>
            
            <span class="span--tag">
              <a href="/tags/设计模式/" title="查看 设计模式 标签">
                #设计模式
              </a>
            </span>
            
          </span>
        
        
          <span class="post-categories">
            <i class="iconfont icon-bookmark" title="类别 | categories"></i>
            
            <span class="span--category">
              <a href="/categories/Coding/" title="查看 Coding 分类">
                #Coding
              </a>
            </span>
            
          </span>
        
      </div>
      <div class="markdown-body">
        <blockquote>
<p>本节主要涉及创造型模式：单例模式、工厂模式，结构型模式：适配器模式、装饰模式、代理模式、外观模式</p>
</blockquote>
<h2 id="创造型模式"><a href="#创造型模式" class="headerlink" title="创造型模式"></a>创造型模式</h2><h3 id="单例模式-Singleton"><a href="#单例模式-Singleton" class="headerlink" title="单例模式 Singleton"></a>单例模式 Singleton</h3><h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><p>单例模式确保一个类只有一个实例，并提供一个访问它的全局访问点。</p>
<h4 id="示例-UML-类图"><a href="#示例-UML-类图" class="headerlink" title="示例 UML 类图"></a>示例 UML 类图</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1giada7msalj316i0cot9l.jpg" alt></p>
<h4 id="示例代码实现"><a href="#示例代码实现" class="headerlink" title="示例代码实现"></a>示例代码实现</h4><p>类<code>Singleton</code>中声明了一个<code>getInstance</code>的静态方法用于返回自身所属类的一个相同实例，如果实例未被创建则创建，如已被创建的直接返回已存在的实例，保持唯一性。</p>
<p>由于 Javascript 内没有<code>private</code>、<code>static</code>等修饰符，之前的<code>instance</code>基本都被用闭包来实现存储，类构造函数也无法约束被调用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Singleton</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line">Singleton.getInstance = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> instance = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance === <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> Singleton()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
<p>进入 ES6 之后，可以通过 Symbol 这个新增的原始类型来保证<code>instance</code>的唯一性</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> instance = <span class="built_in">Symbol</span>()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> getInstance() &#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">this</span>[instance]) &#123;</span><br><span class="line">            <span class="keyword">this</span>[instance] = <span class="keyword">new</span> Singleton()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>[instance]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>得益于 Typescipt 终于可以实现对构造方法的私有化，防止外部调用。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Singleton &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> instance: Singleton;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// ..</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> getInstance(): Singleton &#123;</span><br><span class="line">        <span class="keyword">if</span> (!Singleton.instance) &#123;</span><br><span class="line">            Singleton.instance = <span class="keyword">new</span> Singleton()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Singleton.instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    someMethod() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">client</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 直接实例化会 Typescript 会报错</span></span><br><span class="line">    <span class="comment">// Constructor of class 'Singleton' is private and only accessible within the class declaration.</span></span><br><span class="line">    <span class="keyword">const</span> singleton = <span class="keyword">new</span> Singleton() </span><br><span class="line">    <span class="keyword">const</span> instacneA = Singleton.getInstance()</span><br><span class="line">    <span class="keyword">const</span> instacneB = Singleton.getInstance()</span><br><span class="line">    <span class="keyword">if</span> (instacneA === instacneB) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'他们存储着相同的实例'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">client()</span><br><span class="line"><span class="comment">// console output</span></span><br><span class="line"><span class="comment">// 他们存储着相同的实例</span></span><br></pre></td></tr></table></figure>
<h4 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h4><p>单例模式的应用场景在前端开发中相当常见，例如一些需要保持唯一性的组件类：全局遮罩、联合登录模块、购物车等，所以符合以下要求的场景就可以考虑单例模式：</p>
<ul>
<li>类只能有一个实例，而且可以通过一个周知的访问点访问他</li>
</ul>
<h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><ul>
<li>单例模式可以保证只有一个实例，在特定场景保证稳定性</li>
<li>内存中也只存在一个实例化对象，节省空间消耗</li>
<li>其不太符合单一职责原则，因为其在其内部完成了两件事，但是相比于其解决的问题还是值得使用</li>
</ul>
<h3 id="工厂模式-Factory-Method"><a href="#工厂模式-Factory-Method" class="headerlink" title="工厂模式 Factory Method"></a>工厂模式 Factory Method</h3><h4 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h4><p>工厂方法模式定义一个用于创建对象的接口，这个接口由子类决定实例化哪一个类。</p>
<p>工厂分离出了类实例化的过程，让客户程序使用时不需要关心实例化的过程，并且可以在实例化过程时进行额外的操作，如根据不同的运行环境等返回不同的对象实例等。</p>
<h4 id="示例-UML-类图-1"><a href="#示例-UML-类图-1" class="headerlink" title="示例 UML 类图"></a>示例 UML 类图</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1giadbk6l0pj31qu0jagnq.jpg" alt></p>
<h4 id="示例代码实现-1"><a href="#示例代码实现-1" class="headerlink" title="示例代码实现"></a>示例代码实现</h4><p>Creator 是工厂的抽象方法，也叫创建者，工厂子类通过继承实现具体的创建产品方法，同时这里可以创建一些工厂通用方法被子类调用；</p>
<p>CreatorA… 具体的工厂实现，内部可以在根据不同参数等返回不同的产品实例；</p>
<p>Product 产品接口，用于声明产品内需要实现的方法，对于所有工厂和产品通用；</p>
<p>ProductA… 具体的产品实例；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Product 接口</span></span><br><span class="line"><span class="keyword">interface</span> Product &#123;</span><br><span class="line">    productFn(): <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> ProductA <span class="keyword">implements</span> Product &#123;</span><br><span class="line">    productFn() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`这是：可口可乐`</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> ProductB <span class="keyword">implements</span> Product &#123;</span><br><span class="line">    productFn() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`这是：百事可乐`</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Creator 抽象类，定义了一个 someStuff() 来执行一些公共业务</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> Creator &#123;</span><br><span class="line">    <span class="keyword">protected</span> someStuff() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'进行一些公共业务'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> create(): Product</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CreatorA 工厂A 只生产 可口可乐</span></span><br><span class="line"><span class="keyword">class</span> CreatorA <span class="keyword">extends</span> Creator &#123;</span><br><span class="line">    create() &#123;</span><br><span class="line">        <span class="keyword">super</span>.someStuff()</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ProductA()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CreatorB 工厂B 只生产 百事可乐</span></span><br><span class="line"><span class="keyword">class</span> CreatorB <span class="keyword">extends</span> Creator &#123;</span><br><span class="line">    create() &#123;</span><br><span class="line">        <span class="keyword">super</span>.someStuff()</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ProductB()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 实例化工厂</span></span><br><span class="line"><span class="keyword">const</span> creatorA = <span class="keyword">new</span> CreatorA()</span><br><span class="line"><span class="keyword">const</span> creatorB = <span class="keyword">new</span> CreatorB()</span><br><span class="line"><span class="comment">// 生产</span></span><br><span class="line"><span class="keyword">const</span> productA = creatorA.create()</span><br><span class="line"><span class="keyword">const</span> productB = creatorB.create()</span><br><span class="line"><span class="built_in">console</span>.log(productA.productFn())</span><br><span class="line"><span class="built_in">console</span>.log(productB.productFn())</span><br><span class="line"></span><br><span class="line"><span class="comment">// console output</span></span><br><span class="line"><span class="comment">// 进行一些公共业务</span></span><br><span class="line"><span class="comment">// 进行一些公共业务</span></span><br><span class="line"><span class="comment">// 这是：可口可乐</span></span><br><span class="line"><span class="comment">// 这是：百事可乐</span></span><br></pre></td></tr></table></figure>
<p>同时还有一种<strong>简单工厂模式</strong>，并不在GOF 23种设计模式之中，区别就在于工厂是一个具体类或者静态方法，直接创造具体的产品对象实例，多用于根据不同参数或者环境等返回不同的实例。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Product 接口</span></span><br><span class="line"><span class="keyword">interface</span> Product &#123;</span><br><span class="line">    productFn(): <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CarA</span></span><br><span class="line"><span class="keyword">class</span> CarA <span class="keyword">implements</span> Product &#123;</span><br><span class="line">    productFn() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`这是：阿特兹`</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CarB</span></span><br><span class="line"><span class="keyword">class</span> CarB <span class="keyword">implements</span> Product &#123;</span><br><span class="line">    productFn() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`这是：新款的阿特兹`</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Creator </span></span><br><span class="line"><span class="keyword">class</span> Creator &#123;</span><br><span class="line">    <span class="keyword">static</span> create(year: <span class="built_in">number</span>): Product &#123;</span><br><span class="line">        <span class="comment">// 根据不同参数返回不同的实例</span></span><br><span class="line">        <span class="keyword">if</span> (year &lt; <span class="number">2018</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> CarA()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> CarB()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> car = Creator.create(<span class="number">2019</span>)</span><br><span class="line"><span class="built_in">console</span>.log(car.productFn())</span><br><span class="line"></span><br><span class="line"><span class="comment">// console output</span></span><br><span class="line"><span class="comment">// 这是：新款的阿特兹</span></span><br></pre></td></tr></table></figure>
<h4 id="适用场景-1"><a href="#适用场景-1" class="headerlink" title="适用场景"></a>适用场景</h4><ul>
<li>对象构建十分复杂时</li>
<li>需要根据不同的情况、环境来创建不同的实例</li>
</ul>
<h4 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h4><ul>
<li>符合单一职责原则，产品和创建产品的代码相互独立，只负责自己的职责</li>
<li><p>符合开放封闭原则，客户程序使用产品时，无需修改客户程序代码即可在工厂中增量增加产品类型</p>
</li>
<li><p>工厂生产的产品较多时，可能导致工厂内部的逻辑过于复杂</p>
</li>
</ul>
<h2 id="结构型模式"><a href="#结构型模式" class="headerlink" title="结构型模式"></a>结构型模式</h2><h3 id="适配器模式-Adapter"><a href="#适配器模式-Adapter" class="headerlink" title="适配器模式 Adapter"></a>适配器模式 Adapter</h3><h4 id="概念-2"><a href="#概念-2" class="headerlink" title="概念"></a>概念</h4><p>适配器模式用于将类、对象的接口（方法或属性）转换为客户程序期望的另一个接口（方法或属性），使原本不兼容的类、对象可以在一起工作。</p>
<p>就比如港版 PS4 默认的插头为英制插头，无法直接插到国内的电源接口，需要一个转接头进行转换，而这个转接头就是适配器。</p>
<h4 id="示例-UML-类图-2"><a href="#示例-UML-类图-2" class="headerlink" title="示例 UML 类图"></a>示例 UML 类图</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1giadcrw4plj31fe0ikdhd.jpg" alt></p>
<h4 id="示例代码实现-2"><a href="#示例代码实现-2" class="headerlink" title="示例代码实现"></a>示例代码实现</h4><p>Target 是客户程序 client 所期待的接口，其可以是接口或者类，这里用的是类，其内部有一个<code>request()</code>；</p>
<p>Adaptee 是已存在需要适配的接口（这里也用类），其内部包含接口的特殊请求方法<code>specificRequest()</code>，但是 client 还无法正常使用；</p>
<p>Adapter 是适配器，Adapter 依赖 Adaptee 并继承 Target<code>将 Adaptee 中无法兼容的</code>specificRequest()<code>改造为</code>request()`，以供 client 使用；</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// client 所需要的接口</span></span><br><span class="line"><span class="keyword">class</span> Target &#123;</span><br><span class="line">    <span class="keyword">public</span> request(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'中国标准的插头'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 不兼容的接口，没有 request 方法</span></span><br><span class="line"><span class="keyword">class</span> Adaptee &#123;</span><br><span class="line">    <span class="keyword">public</span> specificRequest(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'港版英国标准的插头'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Adapter 适配器</span></span><br><span class="line"><span class="keyword">class</span> Adapter <span class="keyword">extends</span> Target &#123;</span><br><span class="line">    <span class="keyword">private</span> adaptee: Adaptee</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params">adaptee: Adaptee</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>()</span><br><span class="line">        <span class="keyword">this</span>.adaptee = adaptee</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> request(): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`适配器转换后的 <span class="subst">$&#123;this.adaptee.specificRequest()&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// client 客户程序</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">client</span>(<span class="params">target: Target</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`我是中国标准电源接口，插入的是 <span class="subst">$&#123;target.request()&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化不兼容的接口</span></span><br><span class="line"><span class="keyword">const</span> adaptee = <span class="keyword">new</span> Adaptee()</span><br><span class="line"><span class="comment">// client(adaptee) // 直接给 client 使用 Typescript 会直接报错</span></span><br><span class="line"><span class="comment">// 使用适配器来转换接口</span></span><br><span class="line"><span class="keyword">const</span> adapter = <span class="keyword">new</span> Adapter(adaptee)</span><br><span class="line">client(adapter)</span><br><span class="line"></span><br><span class="line"><span class="comment">// console output</span></span><br><span class="line"><span class="comment">// 我是中国标准电源接口，插入的是 适配器转换后的 港版英国标准的插头</span></span><br></pre></td></tr></table></figure>
<h4 id="适用场景-2"><a href="#适用场景-2" class="headerlink" title="适用场景"></a>适用场景</h4><ul>
<li>项目中存在一些遗留代码，想使用其中一些类，但其接口不符合使用需求</li>
<li>想要复用一些类，这个类可能与其他接口可能不兼容的类一起工作</li>
</ul>
<h4 id="分析-2"><a href="#分析-2" class="headerlink" title="分析"></a>分析</h4><ul>
<li>符合单一职责原则，接口、适配器、旧的接口代码都相互分离没有干扰，职责专一</li>
<li>符合开放封闭原则，需要新增其他兼容接口时，只需要增量添加新的适配器即可，不需要修改客户程序代码</li>
<li>存在大量适配器的话，代码复杂度会增加</li>
</ul>
<h3 id="装饰模式-Decorator"><a href="#装饰模式-Decorator" class="headerlink" title="装饰模式 Decorator"></a>装饰模式 Decorator</h3><h4 id="概念-3"><a href="#概念-3" class="headerlink" title="概念"></a>概念</h4><p>装饰器模式是动态的给对象添加新的职责，在添加新的功能时相比于继承更加弹性灵活，不会影响其派生出的其他对象。每个装饰器不但包含着上一层装饰器的状态、方法而且还能对自己进行扩展，同时通过调用超类上的方法形成一条装饰链。</p>
<h4 id="示例-UML-类图-3"><a href="#示例-UML-类图-3" class="headerlink" title="示例 UML 类图"></a>示例 UML 类图</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1giaddrxl1dj31ni0oywhb.jpg" alt></p>
<h4 id="示例代码实现-3"><a href="#示例代码实现-3" class="headerlink" title="示例代码实现"></a>示例代码实现</h4><p>Shape 是一个基础接口，其声明了实现其的类中需要 <code>draw()</code> 这个具体方法；</p>
<p>Circle 和 Square 为具体形状类，实现了 Shape 接口；</p>
<p>ShapeDecorator 为基础装饰类，也实现了 Shape 基础接口，同时拥有一个指向其实现后实例化对象的引用成员变量；</p>
<p>RedBorderDecorator 和 BlueBackgroundDecorator 为具体装饰类，重写基类的 <code>draw()</code> 方法，然后在其内部调用父类之前的方法进行一些额外的行为。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基础接口</span></span><br><span class="line"><span class="keyword">interface</span> Shape &#123;</span><br><span class="line">    draw(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 具体形状类</span></span><br><span class="line"><span class="keyword">class</span> Circle <span class="keyword">implements</span> Shape &#123;</span><br><span class="line">    <span class="keyword">public</span> draw() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'画一个圆形'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 具体形状类</span></span><br><span class="line"><span class="keyword">class</span> Square <span class="keyword">implements</span> Shape &#123;</span><br><span class="line">    <span class="keyword">public</span> draw() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'画一个正方形'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 基础装饰类</span></span><br><span class="line"><span class="keyword">class</span> ShapeDecorator <span class="keyword">implements</span> Shape &#123;</span><br><span class="line">    <span class="keyword">protected</span> shape: Shape</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params">shape: Shape</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.shape = shape</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> draw() &#123;</span><br><span class="line">        <span class="keyword">this</span>.shape.draw()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体装饰类</span></span><br><span class="line"><span class="keyword">class</span> RedBorderDecorator <span class="keyword">extends</span> ShapeDecorator &#123;</span><br><span class="line">    <span class="keyword">public</span> draw() &#123;</span><br><span class="line">        <span class="keyword">super</span>.draw()</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'添加红色的边框'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> BlueBackgroundDecorator <span class="keyword">extends</span> ShapeDecorator &#123;</span><br><span class="line">    <span class="keyword">public</span> draw() &#123;</span><br><span class="line">        <span class="keyword">super</span>.draw()</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'添加蓝色的背景'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户程序 接受 Shape</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">client</span>(<span class="params">shape: Shape</span>) </span>&#123;</span><br><span class="line">    shape.draw()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> circle = <span class="keyword">new</span> Circle()</span><br><span class="line"><span class="keyword">const</span> redBorderDecorator = <span class="keyword">new</span> RedBorderDecorator(circle)</span><br><span class="line"><span class="keyword">const</span> blueBackgroundDecorator = <span class="keyword">new</span> BlueBackgroundDecorator(redBorderDecorator)</span><br><span class="line"><span class="comment">// 传入装饰过的 Circle</span></span><br><span class="line">client(blueBackgroundDecorator)</span><br><span class="line"></span><br><span class="line"><span class="comment">// console output</span></span><br><span class="line"><span class="comment">// 画一个圆形</span></span><br><span class="line"><span class="comment">// 添加红色的边框</span></span><br><span class="line"><span class="comment">// 添加蓝色的背景</span></span><br></pre></td></tr></table></figure>
<p>ES7 中新增的 decorator 也是一种装饰器模式的思路，可以在不修改原有代码的情况下，动态的添加方法、修改属性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params">target, name, descriptor</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// descriptor.value 为 object 数据描述符 和 writable 平级</span></span><br><span class="line">    <span class="keyword">const</span> oldFn = descriptor.value</span><br><span class="line">    descriptor.value = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`调用了 <span class="subst">$&#123;name&#125;</span> 方法，传入参数为 `</span>, <span class="built_in">arguments</span>)</span><br><span class="line">        <span class="comment">// 仍执行原来的方法 this 也原封不动传递过去</span></span><br><span class="line">        <span class="keyword">return</span> oldFn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 返回修改过的 函数对象</span></span><br><span class="line">    <span class="keyword">return</span> descriptor</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Math</span> </span>&#123;</span><br><span class="line">    @log</span><br><span class="line">    add(a, b) &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> math = <span class="keyword">new</span> <span class="built_in">Math</span>()</span><br><span class="line"><span class="keyword">const</span> result = math.add(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="built_in">console</span>.log(result)</span><br><span class="line"><span class="comment">// 调用了 add 方法，传入参数为  Arguments(2) [1, 2, callee: ƒ, Symbol(Symbol.iterator): ƒ]</span></span><br><span class="line"><span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<h4 id="适用场景-3"><a href="#适用场景-3" class="headerlink" title="适用场景"></a>适用场景</h4><ul>
<li>想不修改原有代码，并在运行时为对象增加额外的行为</li>
<li>难以通过继承来扩展对象时</li>
<li>ES7 新增的 decorator，通过 @decorator 类似的关键字给类和方法添加装饰器</li>
</ul>
<h4 id="分析-3"><a href="#分析-3" class="headerlink" title="分析"></a>分析</h4><ul>
<li>符合单一职责原则，额外添加的装饰器都保持完成自身一项职责</li>
<li>符合开放封闭原则，无需修改原有代码，增量增加装饰器即可</li>
<li>可以用多个装饰器实现链式调用，动态组合行为</li>
<li>缺点是增加了系统的复杂度，如果嵌套调用出现异常时需要链式逐步排查</li>
</ul>
<h3 id="代理模式-Proxy"><a href="#代理模式-Proxy" class="headerlink" title="代理模式 Proxy"></a>代理模式 Proxy</h3><h4 id="概念-4"><a href="#概念-4" class="headerlink" title="概念"></a>概念</h4><p>代理模式是为某个对象提供一个代理，并由这个代理对象控制对原对象的访问，允许将访问提交给原对象前后进行一些处理。</p>
<h4 id="示例-UML-类图-4"><a href="#示例-UML-类图-4" class="headerlink" title="示例 UML 类图"></a>示例 UML 类图</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1giadexl2f2j318e0hggnh.jpg" alt></p>
<h4 id="示例代码实现-4"><a href="#示例代码实现-4" class="headerlink" title="示例代码实现"></a>示例代码实现</h4><p>Subject 声明了抽象主题，其为 Proxy 和 RealSubject 的共同接口；</p>
<p>RealSubject 为真实主题，内部包含一个真实的<code>request()</code>方法进行一些实际的业务操作；</p>
<p>Proxy 为代理主题，包含了对 RealSubject 的引用成员变量，Proxy 也实现了 Subject 接口，所以可以随时替换掉 RealSubject 供 Client 使用。同时在其内部可以在进行 RealSubject 前后进行一些逻辑处理，如访问控制、记录日志等，这里做了一个访问控制。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Subject &#123;</span><br><span class="line">    request(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> RealSubject <span class="keyword">implements</span> Subject &#123;</span><br><span class="line">    <span class="keyword">public</span> request() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'RealSubject: 发出真实的请求'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Proxy <span class="keyword">implements</span> Subject &#123;</span><br><span class="line">    <span class="keyword">private</span> realsubject: RealSubject</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params">realsubject: RealSubject</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.realsubject = realsubject</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> checkBeforeRequest() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Proxy: 访问控制，验证是否能进行请求'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> request() &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.checkBeforeRequest()) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'Proxy: 访问控制，验证通过'</span>)</span><br><span class="line">            <span class="keyword">this</span>.realsubject.request()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// client 客户程序接受实现 Subject 的类的实例化对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">client</span>(<span class="params">subject: Subject</span>) </span>&#123;</span><br><span class="line">    subject.request()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> realSubject = <span class="keyword">new</span> RealSubject()</span><br><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> Proxy(realSubject)</span><br><span class="line">client(proxy)</span><br></pre></td></tr></table></figure>
<p>另外 ES6 中的 Proxy 也是代理模式的一种思想实现，实现对对象上内部变量变化之前进行一些诸如访问控制之类的逻辑处理。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 反诬不动产</span></span><br><span class="line"><span class="keyword">const</span> apartment = &#123;</span><br><span class="line">    apartmentName: <span class="string">'XXX公寓'</span>,</span><br><span class="line">    price: <span class="number">2000000</span>,</span><br><span class="line">    phone: <span class="string">'业主电话：18288882222'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理房产中介</span></span><br><span class="line"><span class="keyword">const</span> agent = <span class="keyword">new</span> Proxy(apartment, &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @param &#123;star&#125; target 被代理的目标对象</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125; key 目标对象的 key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">get</span>: <span class="function"><span class="keyword">function</span>(<span class="params">target, key</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (key === <span class="string">'phone'</span>) &#123;</span><br><span class="line">            <span class="comment">// 不能直接给业主电话</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'房产中介电话：13989930022'</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (key === <span class="string">'price'</span>) &#123;</span><br><span class="line">            <span class="comment">// 报价加上税费等</span></span><br><span class="line">            <span class="keyword">return</span> target[key] + target[key] * <span class="number">0.02</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 没命中 返回目标对象对应 key 的 value</span></span><br><span class="line">        <span class="keyword">return</span> target[key]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">set</span>: <span class="function"><span class="keyword">function</span>(<span class="params">target, key, value</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (key === <span class="string">'offerPrice'</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (value &lt; <span class="number">2000000</span>) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'报价太低了！'</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                target[key] = value</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(agent.apartmentName) <span class="comment">// 公寓房产名称可以给对方</span></span><br><span class="line"><span class="built_in">console</span>.log(agent.phone) <span class="comment">// 手机号不能返回</span></span><br><span class="line"><span class="built_in">console</span>.log(agent.price) <span class="comment">// 价格需要进行额外处理</span></span><br><span class="line">agent.offerPrice = <span class="number">1800000</span> <span class="comment">// 客户报价</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// console output</span></span><br><span class="line"><span class="comment">// XXX公寓</span></span><br><span class="line"><span class="comment">// 房产中介电话：13989930022</span></span><br><span class="line"><span class="comment">// 2040000</span></span><br><span class="line"><span class="comment">// 报价太低了！</span></span><br></pre></td></tr></table></figure>
<h4 id="适用场景-4"><a href="#适用场景-4" class="headerlink" title="适用场景"></a>适用场景</h4><ul>
<li>保护代理，进行访问控制，防止对对象进行权限以外的操作等</li>
<li>虚拟代理，建立一个补偿用的大开销对象，使用代理延时化创建</li>
<li>日志代理，在请求时通过代理进行一些日志操作</li>
<li>远程代理，通过代理处理一些额外的网络传输相关的操作，并与远程服务器通信</li>
<li>智能代理，通过代理在进行对象访问时进行一些附加处理</li>
</ul>
<h4 id="分析-4"><a href="#分析-4" class="headerlink" title="分析"></a>分析</h4><ul>
<li>符合开放闭合原则，增量添加代理无需修改原有代码</li>
<li>协调客户程序和目标对象之间的关系，一定程度上降低系统耦合度</li>
<li>缺点是代理模式增加了处理路径长度，降低处理速度</li>
</ul>
<h3 id="外观模式-Facade"><a href="#外观模式-Facade" class="headerlink" title="外观模式 Facade"></a>外观模式 Facade</h3><h4 id="概念-5"><a href="#概念-5" class="headerlink" title="概念"></a>概念</h4><p>外观模式是为子系统、库等中的一组接口提供一个统一的高层接口，让其更加容易使用。</p>
<h4 id="示例-UML-类图-5"><a href="#示例-UML-类图-5" class="headerlink" title="示例 UML 类图"></a>示例 UML 类图</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1giadg1q135j31820psq4l.jpg" alt></p>
<h4 id="示例代码实现-5"><a href="#示例代码实现-5" class="headerlink" title="示例代码实现"></a>示例代码实现</h4><p>Facade 外观类，集合了子系统中的各个实例，根据需要在内部方法中处理对应的子系统操作，再暴露出供客户端进行使用。</p>
<p>SubSystem 子系统类，代表诸多的子系统可以是类的集合，独自处理响应的业务，外观类对与子系统就是个客户端。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Facade &#123;</span><br><span class="line">    <span class="keyword">public</span> operation() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Facade: 根据需要调用子系统'</span>)</span><br><span class="line">        <span class="keyword">const</span> subSystemA = <span class="keyword">new</span> SubSystemA()</span><br><span class="line">        <span class="keyword">const</span> subSystemB = <span class="keyword">new</span> SubSystemB()</span><br><span class="line">        subSystemA.operation1()</span><br><span class="line">        subSystemA.operationN()</span><br><span class="line">        subSystemB.operationN()</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Facade: 执行完毕'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> SubSystemA &#123;</span><br><span class="line">    <span class="keyword">public</span> operation1() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'SubSystemA: 处理相关业务1 - H'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> operationN() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'SubSystemA: 处理相关业务N - O'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> SubSystemB &#123;</span><br><span class="line">    <span class="keyword">public</span> operation1() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'SubSystemB: 处理相关业务1'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> operationN() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'SubSystemB: 处理相关业务N - T'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 客户程序 只需要关心外观 不需要关心子系统</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">client</span>(<span class="params">facade: Facade</span>) </span>&#123;</span><br><span class="line">    facade.operation()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> facade = <span class="keyword">new</span> Facade()</span><br><span class="line">client(facade)</span><br><span class="line"></span><br><span class="line"><span class="comment">// console output</span></span><br><span class="line"><span class="comment">// Facade: 根据需要调用子系统</span></span><br><span class="line"><span class="comment">// SubSystemA: 处理相关业务1 - H</span></span><br><span class="line"><span class="comment">// SubSystemA: 处理相关业务N - O</span></span><br><span class="line"><span class="comment">// SubSystemB: 处理相关业务N - T</span></span><br><span class="line"><span class="comment">// Facade: 执行完毕</span></span><br></pre></td></tr></table></figure>
<h4 id="适用场景-5"><a href="#适用场景-5" class="headerlink" title="适用场景"></a>适用场景</h4><p>外观模式在业务中应用相当广泛，大部分情况客户程序都不需要了解复杂的内部系统实现和关系，诸如复杂的类库 API 二次封装内部方法对外暴露等。</p>
<ul>
<li>在维护一个负责的子系统时，需要提供一个简单的接口供客户程序调用。随着时间的推移，子系统往往变的越来越复杂，使用外观模式可以快速的指向需要的子系统功能，满足客户程序的需求。</li>
<li>分层设计时，可以要求子系统应用外观模式定义其各层次的入口，让他们通过外观来进行交互，减少耦合性。</li>
</ul>
<h4 id="分析-5"><a href="#分析-5" class="headerlink" title="分析"></a>分析</h4><ul>
<li>降低客户程序可以和子系统之间关联，适当的进行解耦</li>
<li>设计不当可能让外观类与相当多的类耦合在一块，逐步成为上帝对象</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://www.cnblogs.com/TomXu/archive/2011/12/15/2288411.html" target="_blank" rel="noopener">深入理解JavaScript系列 - 汤姆大叔</a></li>
<li><a href="https://design-patterns.readthedocs.io/zh_CN/latest/index.html" target="_blank" rel="noopener">图说设计模式</a></li>
<li><a href="https://tecknight.xyz/blog/常见设计模式概要及其实践-typescript实现/" target="_blank" rel="noopener">常见设计模式概要及其实践-TypeScript实现</a></li>
<li><a href="http://c.biancheng.net/design_pattern/" target="_blank" rel="noopener">Java设计模式：23种设计模式全面解析</a></li>
</ul>
<h2 id="相关文章"><a href="#相关文章" class="headerlink" title="相关文章"></a>相关文章</h2><ul>
<li><a href="/2019/03/22/typescript-design-pattern-1/">Typescript 重走常用设计模式（一）</a></li>
<li><a href="/2019/03/22/typescript-design-pattern-3/">Typescript 重走常用设计模式（三）</a></li>
</ul>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/2019/03/22/typescript-design-pattern-1/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>PREV</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">2019-03-22</span>
            
              <span class="post-tags">
                <i class="iconfont icon-tags" title="标签 | tags"></i>
                
                <span class="span--tag">
                  <a href="/tags/typescript/" title="查看 typescript 标签">
                    #typescript
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/javascript/" title="查看 javascript 标签">
                    #javascript
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/设计模式/" title="查看 设计模式 标签">
                    #设计模式
                  </a>
                </span>
                
              </span>
            
            
              <span class="post-categories">
                <i class="iconfont icon-bookmark" title="类别 | categories"></i>
                
                <span class="span--category">
                  <a href="/categories/Coding/" title="查看 Coding 分类">
                    #Coding
                  </a>
                </span>
                
              </span>
            
          </div>
          <div class="post-foot-prev">
            
              <a href="/2019/03/22/typescript-design-pattern-3/" target="_self">
                <span>NEXT</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div class="post-catalog" id="catalog">
    <div class="title">目录</div>
    <div class="catalog-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#创造型模式"><span class="toc-text">创造型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#单例模式-Singleton"><span class="toc-text">单例模式 Singleton</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#概念"><span class="toc-text">概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#示例-UML-类图"><span class="toc-text">示例 UML 类图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#示例代码实现"><span class="toc-text">示例代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#适用场景"><span class="toc-text">适用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#分析"><span class="toc-text">分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#工厂模式-Factory-Method"><span class="toc-text">工厂模式 Factory Method</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#概念-1"><span class="toc-text">概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#示例-UML-类图-1"><span class="toc-text">示例 UML 类图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#示例代码实现-1"><span class="toc-text">示例代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#适用场景-1"><span class="toc-text">适用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#分析-1"><span class="toc-text">分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#结构型模式"><span class="toc-text">结构型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#适配器模式-Adapter"><span class="toc-text">适配器模式 Adapter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#概念-2"><span class="toc-text">概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#示例-UML-类图-2"><span class="toc-text">示例 UML 类图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#示例代码实现-2"><span class="toc-text">示例代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#适用场景-2"><span class="toc-text">适用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#分析-2"><span class="toc-text">分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#装饰模式-Decorator"><span class="toc-text">装饰模式 Decorator</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#概念-3"><span class="toc-text">概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#示例-UML-类图-3"><span class="toc-text">示例 UML 类图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#示例代码实现-3"><span class="toc-text">示例代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#适用场景-3"><span class="toc-text">适用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#分析-3"><span class="toc-text">分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代理模式-Proxy"><span class="toc-text">代理模式 Proxy</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#概念-4"><span class="toc-text">概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#示例-UML-类图-4"><span class="toc-text">示例 UML 类图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#示例代码实现-4"><span class="toc-text">示例代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#适用场景-4"><span class="toc-text">适用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#分析-4"><span class="toc-text">分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#外观模式-Facade"><span class="toc-text">外观模式 Facade</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#概念-5"><span class="toc-text">概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#示例-UML-类图-5"><span class="toc-text">示例 UML 类图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#示例代码实现-5"><span class="toc-text">示例代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#适用场景-5"><span class="toc-text">适用场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#分析-5"><span class="toc-text">分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-text">参考</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#相关文章"><span class="toc-text">相关文章</span></a></li></ol>
    </div>
  </div>

  <!-- <script src="/js/catalog.js"></script> -->
  <script src="https://cdn.jsdelivr.net/gh/mtmzorro/mtmzorro.github.io@master/js/catalog.js"></script>



    
      <div class="comments-container">
        


  <script src='//unpkg.com/valine/dist/Valine.min.js'></script>

  <div id="vcomments"></div>

  <script>
    new Valine({
      el: '#vcomments',
      appId: 'kUOr7QeM3HuECQcFmC2xKIxD-gzGzoHsz',
      appKey: 'rkioF9XeiLygfxEhXSrKilPY',
      placeholder: 'Welcome!',
      avatar: 'retro'
    })
  </script>

    <style>
      .comments-container .v .vempty {
        display: none!important;
      }
    </style>




      </div>
    
  </div>

  
        <div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" href="https://github.com/mtmzorro/">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
        <li>
          <a title="email" href="mtmzorro@foxmail.com">
            <i class="iconfont icon-envelope"></i>
          </a>
        </li>
      
        <li>
          <a title="微博" href="http://weibo.com/mtmzorro">
            <i class="iconfont icon-weibo"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    <div class="footer-more">
      <a href="https://mtmzorro.com">Copyright © mTmzorro 2020</a>
    </div>
  
    <div class="footer-more">
      <a href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
    </div>
  
</div>

      </div>

      <div class="back-to-top hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>

<!-- <script src="/js/backtotop.js"></script> -->
<script src="https://cdn.jsdelivr.net/gh/mtmzorro/mtmzorro.github.io@master/js/backtotop.js"></script>


    </div>
  </body>
</html>
